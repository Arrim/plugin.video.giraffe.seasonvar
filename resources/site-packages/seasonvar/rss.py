#!/usr/bin/env python
# coding: utf-8
# vim:fenc=utf-8:sts=0:ts=4:sw=4:et:tw=80

#
# Copyright Â© 2016 gr4ph3 <giraffeoncode@gmail.com>
#
# Distributed under terms of the MIT license.
#
from __future__ import unicode_literals
try:
    from seasonvar.requester import Requester
except ImportError:
    from requester import Requester
import re
from datetime import datetime
import time


FEEDURL = 'http://seasonvar.ru/rss.php'


def items():
    requester = Requester()
    regexp = re.compile(
        r'<title><!\[CDATA\[([^\]]+?)\]\]><\/title>[^<]*?'
        '<link>([^<]+?)<\/link>[^<]*?'
        '<pubDate>([^<]+?)<\/pubDate>',
        re.DOTALL)
    xml = requester.get(FEEDURL)
    for (entry, link, datestr) in regexp.findall(xml):
        yield {
            'entry': entry,
            'url': requester.relurl(link),
            # workaround for shitty datetime.strptime in kodi
            # http://forum.kodi.tv/showthread.php?tid=112916
            'date': datetime(*(time.strptime(datestr[:-6],
                             '%a, %d %b %Y %H:%M:%S')[0:6]))
        }
