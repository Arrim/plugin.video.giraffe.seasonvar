# coding: utf-8
# vim:fenc=utf-8:sts=0:ts=4:sw=4:et:tw=80

#
# Copyright Â© 2016 gr4ph3 <giraffeoncode@gmail.com>
#
# Distributed under terms of the MIT license.
#
from __future__ import unicode_literals
from seasonvar.requester import Requester
import re


PAGEURL = 'http://seasonvar.ru'


def items(datestr):
    requester = Requester()
    cregexp = re.compile(
        r'<div class="ff1">(\d{2}\.\d{2}\.\d{4})(.*?)'
        '<div class="film-list-block-title">',
        re.DOTALL)
    sregexp = re.compile(
        r'<a href="(\/serial-.+?\.html)" class="film-list-item-link">'
        '(.+?)<\/a>(.*?)<span>(.+?)<\/span>',
        re.DOTALL)
    html = requester.get(PAGEURL)
    for (date, content) in cregexp.findall(html):
        if datestr == date:
            for (url, name, s, e) in sregexp.findall(content):
                yield {
                    'name': name.strip(),
                    'changes': '{0} {1}'.format(s.strip(), e.strip()).strip(),
                    'url': requester.relurl(url),
                }
