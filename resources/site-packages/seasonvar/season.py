# coding: utf-8

#
# Copyright Â© 2017 weirdgiraffe <giraffe@cyberzoo.xyz>
#
# Distributed under terms of the MIT license.
#
from __future__ import unicode_literals
import re
from seasonvar import SeasonvarRequester


class Season:
    def __init__(self, **kwargs):
        self.url = kwargs.get('url')
        self.id = kwargs.get('id')
        self.trname = kwargs.get('trname')
        self.name = kwargs.get('name')
        self.number = kwargs.get('number')
        self.thumb = self._thumb_url(self.url)
        self.html = kwargs.get('html')
        self.__requester = kwargs.get('requester', SeasonvarRequester())
        self.__secure = None

    @property
    def secure(self):
        return self._secure(self.html)

    @staticmethod
    def _secure(html):
        r = re.compile(r'secureMark\s*=\s*"([a-f0-9]+)"')
        for s in r.findall(html):
            return s

    @staticmethod
    def _thumb_url(url):
        r = re.compile(r'^(?:http://.*?)(\/serial-(\d+)-(?:.+?)'
                       r'(?:-(\d+)-(?:sezon|season))?\.html)$')
        for sid in r.findall(url):
            return 'http://cdn.seasonvar.ru/oblojka/{0}.jpg'.format(sid)
