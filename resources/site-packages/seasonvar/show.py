# coding: utf-8

#
# Copyright Â© 2017 weirdgiraffe <giraffe@cyberzoo.xyz>
#
# Distributed under terms of the MIT license.
#
from __future__ import unicode_literals
import re
from seasonvar.season import Season
try:
    from seasonvar.requester import SeasonvarRequester
except ImportError:
    from requester import SeasonvarRequester


class Show:
    def __init__(self, url, html=None):
        self.__requester = SeasonvarRequester()
        self.url = self.__requester.relurl(url)
        self.__html = html
        self.__current_season = None
        self.seasons = list(self._seasons_from_html())

    @property
    def current_season(self):
        for season in self.seasons:
            if season.url == self.url:
                season.html = self.__html
                return season

    def _seasons_from_html(self):
        r = re.compile(
            r'<h2>.*?<a[^>]+?href="(/serial-.*?\.html)"',
            re.DOTALL)
        if self.__html is None:
            absurl = self.__requester.absurl(self.url)
            self.__html = self.__requester.get(absurl)
        for surl in r.findall(self.__html):
            yield Season(url=surl, requester=self.__requester)
